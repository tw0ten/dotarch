#!/usr/bin/env sh
echo "init"
git submodule update --init --recursive

( echo "packages"
	sudo pacman -Syu

	AUR_HELPER=paru
	i() { $AUR_HELPER -S "$@"; }
	( cd "$(mktemp -d)" && git clone "https://aur.archlinux.org/$AUR_HELPER" . && makepkg -si )

	i neovim tmux
	i ranger openssh btop fastfetch ripgrep
	i jdk-openjdk rust python npm nasm
	i nvidia nvidia-utils nvidia-settings xorg xorg-xinit xkb-switch pipewire libnotify ttf-jetbrains-mono ttf-nerd-fonts-symbols-mono noto-fonts-emoji noto-fonts-cjk
	i vlc qbittorrent libreoffice-still gimp firefox steam vesktop telegram-desktop bemoji dunst picom flameshot feh
echo )

( cd config || return; echo "config/"
	lncfg() {
		echo "$1"
		mkdir -p "$(dirname "$HOME/$2")"
		ln -sf "$PWD/$1" "$HOME/$2"
	}

	lncfg bash/rc .bashrc
	lncfg bash/profile .bash_profile
	lncfg tmux .tmux.conf
	lncfg nvim .config/nvim
	lncfg xrc .xinitrc
	lncfg input .inputrc
	lncfg fastfetch .config/fastfetch
	lncfg flameshot .config/flameshot/flameshot.ini
	lncfg paru .config/paru/paru.conf
	lncfg btop .config/btop/btop.conf
	lncfg git .gitconfig

	sudo cp ssh/config /etc/ssh/ssh_config
	sudo cp ssh/d /etc/ssh/sshd_config
	sudo cp dunst /etc/dunst/dunstrc
	sudo cp grub /etc/default/grub
	sudo cp issue /etc/issue
	sudo cp picom /etc/xdg/picom.conf
	sudo cp pacman /etc/pacman.conf
	sudo cp nobeep /etc/modprobe.d/nobeep.conf
echo )

( cd program || return; echo "program/"
	for dir in */; do (
		echo "${dir}build"
		cd "$dir" && ./build
	) done
echo )

( cd etc || return; echo "etc/"
	mkdir -p ~/.secret

	( cd fehfetch && ./build )

	sudo cp dconfirm /usr/bin
	sudo cp smenu /usr/bin
	sudo cp ./*.desktop /usr/share/applications
	sudo cp cat.png /boot/grub/bg.png

	localectl set-x11-keymap us,ru
	localectl set-keymap --no-convert us
	sudo grub-mkconfig -o /boot/grub/grub.cfg
echo )

. ~/.bash_profile
