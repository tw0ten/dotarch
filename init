#!/usr/bin/env sh
echo "init"
git submodule update --init --recursive

( echo "packages"
	sudo pacman -Syu

	sudo pacman -S git base-devel networkmanager 
	sudo pacman -S tmux neovim ranger
	sudo pacman -S vlc qbittorrent libreoffice-still gimp firefox feh
	sudo pacman -S nvidia nvidia-utils nvidia-settings lib32-nvidia-utils xorg xorg-apps xorg-server xorg-xinit pipewire dunst picom flameshot 
	sudo pacman -S xdotool xsel xclip bc qt6-tools bluez bluez-utils libxinerama libxft bash-completion

	AUR_HELPER=paru
	sudo pacman -S $AUR_HELPER || ( cd $(mktemp -d) && git clone "https://aur.archlinux.org/$AUR_HELPER" . && makepkg -si )
	$AUR_HELPER -S mkinitcpio-firmware bemoji github-desktop-bin
echo )

( echo "config/" && cd config
	mkdir ~/.config
	sudo mkdir /root/.config

	lncfg() {
		echo -e "\t$1"
		ln -sf "$PWD/$1" $2
		true || sudo ln -sf "$HOME/$2" "/root/$2"
	}

	lncfg bash/rc .bashrc
	lncfg bash/profile .bash_profile
	lncfg tmux .tmux.conf
	lncfg nvim .config/nvim
	lncfg xrc .xinitrc
	lncfg input .inputrc
	lncfg fastfetch .config/fastfetch
	lncfg flameshot .config/flameshot/flameshot.ini
	lncfg paru .config/paru/paru.conf

	cp git ~/.gitconfig
	sudo cp *.desktop /usr/share/applications
	sudo cp dunst /etc/dunst/dunstrc
	sudo cp grub /etc/default/grub
	sudo cp issue /etc/issue
	sudo cp picom /etc/xdg/picom.conf
	sudo cp pacman /etc/pacman.conf
	sudo cp nobeep /etc/modprobe.d/nobeep.conf
echo )

( echo "program/" && cd program
	for dir in */; do (
		echo -e "\t${dir}build"
		cd $dir
		. ./build
	) done
echo )

( echo "etc/" && cd etc
	mkdir ~/.secret
	( cd fehfetch && ./build )
	sudo cp dconfirm /usr/bin
	sudo cp smenu /usr/bin
	sudo cp cat.png /boot/grub/bg.png
echo )

. ~/.bash_profile
